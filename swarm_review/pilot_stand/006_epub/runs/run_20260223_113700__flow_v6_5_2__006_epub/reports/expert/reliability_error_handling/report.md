# Expert Report: reliability_error_handling

Agent: `019c89a6-7682-7202-804c-9568b7ca1378`

| # | Title | Severity | Evidence | Remediation |
|---|---|---|---|---|
| 1 | Translation can be returned as successful after state finalization failed | P0 | `core/translation/pipeline.py:305`, `core/translation/pipeline.py:316`, `core/translation/pipeline.py:333`, `core/translation/pipeline.py:442`, `core/translation/pipeline.py:449` | Make `_complete_translation_with_retry` raise on exhausted retries, and fail the request path instead of returning `success=True`. Only return success after state completion is confirmed. |
| 2 | Timeout errors are downgraded to generic exceptions | P1 | `core/translation/pipeline.py:66`, `core/translation/pipeline.py:70`, `core/translation/pipeline.py:164`, `core/translation/pipeline.py:167` | Preserve typed timeout propagation (`raise` original `asyncio.TimeoutError` or raise `TranslationTimeoutError` with `from`). This keeps retry/fallback logic and handlers accurate. |
| 3 | “All providers failed” is reported as `NO_RESULTS` from primary provider | P1 | `core/fallback/strategy.py:64`, `core/fallback/strategy.py:67`, `core/fallback/strategy.py:70`, `core/fallback/strategy.py:128`, `core/fallback/strategy.py:129`, `core/fallback/strategy.py:130` | In `handle_all_failed`, compute final status from attempt outcomes (prefer `ERROR`/`TIMEOUT` over `NO_RESULTS`) and avoid hardcoding provider attribution to `FLIBUSTA`. |
| 4 | Zero-attempt fallback path can trigger model validation failure and generic error fallback | P1 | `core/fallback/orchestrator.py:113`, `core/fallback/orchestrator.py:118`, `core/fallback/orchestrator.py:193`, `core/fallback/orchestrator.py:196`, `core/fallback/orchestrator.py:208`, `core/fallback/models.py:242` | Add explicit handling when all providers are skipped (`attempts == []`) before constructing `FallbackResult`, and return a deterministic structured error instead of relying on broad catch-all recovery. |
| 5 | Language fallback search does not contain attempt-level runtime exceptions | P1 | `core/services/book_search_with_fallback.py:98`, `core/services/book_search_with_fallback.py:123`, `core/services/book_search_with_fallback.py:144`, `core/services/book_search_with_fallback.py:175`, `core/telegram_book_service.py:89`, `core/telegram_book_service.py:201` | Wrap each attempt and enrichment step in `try/except`, convert thrown errors into `SearchAttempt.error`, and continue the fallback chain so failures are aggregated instead of aborting the whole operation. |
